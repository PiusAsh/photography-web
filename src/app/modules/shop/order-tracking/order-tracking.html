<app-navbar class="mb-3"></app-navbar>

<div class="tracking-container">
  <!-- Header Section -->
  <div class="tracking-header">
    <div class="container">
      <div class="header-content">
        <div class="header-left">
          <h1 class="tracking-title">
            <i class="bi bi-search"></i>
            Track Your Orders
          </h1>
          <p class="tracking-subtitle">Enter your email and secret code to view your order history</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="tracking-main">
    <div class="container">
      <!-- Authentication Form -->
      <div class="auth-section" *ngIf="!isAuthenticated">
        <div class="auth-card">
          <div class="auth-header">
            <h3>
              <i class="bi bi-shield-lock"></i>
              Order Authentication
            </h3>
            <p class="auth-subtitle">Please provide your credentials to access your orders</p>
          </div>

          <form [formGroup]="trackingForm" (ngSubmit)="trackOrders()" class="auth-form">
            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-envelope"></i>
                Email Address
              </label>
              <input 
                type="email" 
                class="form-control" 
                formControlName="email"
                placeholder="Enter your email address"
              />
              <div class="error-message" *ngIf="f['email'].touched && f['email'].invalid">
                <i class="bi bi-exclamation-circle"></i>
                <span *ngIf="f['email'].errors?.['required']">Email is required</span>
                <span *ngIf="f['email'].errors?.['email']">Please enter a valid email</span>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <i class="bi bi-key"></i>
                Secret Code
              </label>
              <input 
                type="password" 
                class="form-control" 
                formControlName="secretCode"
                placeholder="Enter your secret code"
              />
              <div class="error-message" *ngIf="f['secretCode'].touched && f['secretCode'].invalid">
                <i class="bi bi-exclamation-circle"></i>
                <span *ngIf="f['secretCode'].errors?.['required']">Secret code is required</span>
                <span *ngIf="f['secretCode'].errors?.['minlength']">Secret code must be at least 6 characters</span>
              </div>
            </div>

            <div class="form-actions">
              <button 
                class="btn-track-orders" 
                type="submit" 
                [disabled]="trackingForm.invalid || isLoading"
              >
                <i class="bi bi-search" *ngIf="!isLoading"></i>
                <i class="bi bi-arrow-clockwise" *ngIf="isLoading"></i>
                <span *ngIf="!isLoading">Track Orders</span>
                <span *ngIf="isLoading">Loading...</span>
              </button>
            </div>
          </form>

          <div class="auth-info">
            <div class="info-card">
              <i class="bi bi-info-circle"></i>
              <div class="info-content">
                <h4>How to get your secret code?</h4>
                <p>Your secret code is sent to your email when you place an order. Check your inbox or spam folder for the order confirmation email.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders Display -->
      <div class="orders-section" *ngIf="isAuthenticated">
        <div class="orders-header">
          <div class="header-left">
            <h2>
              <i class="bi bi-box"></i>
              Your Orders
            </h2>
            <p class="customer-email">Orders for: {{ customerEmail }}</p>
          </div>
          <div class="header-right">
            <button class="btn-reset" (click)="resetTracking()">
              <i class="bi bi-arrow-left"></i>
              Track Different Orders
            </button>
          </div>
        </div>

        <!-- Orders List -->
        <div class="orders-list" *ngIf="orders.length > 0">
          <div class="order-card" *ngFor="let order of orders">
            <div class="order-header">
              <div class="order-info">
                <h3 class="order-number">Order #{{ order.id }}</h3>
                <p class="order-date">{{ formatDate(order.orderDate) }}</p>
              </div>
              <div class="order-status">
                <span class="status-badge" [class]="getOrderStatusClass(order.orderStatus)">
                  <i [class]="getOrderStatusIcon(order.orderStatus)"></i>
                  {{ order.orderStatus }}
                </span>
              </div>
            </div>

            <div class="order-items">
              <div class="order-item" *ngFor="let item of order.items">
                <div class="item-image">
                  <img [src]="item.productImage || 'https://via.placeholder.com/100x100.png?text=No+Image'" [alt]="item.productName" />
                </div>
                <div class="item-details">
                  <h4 class="item-name">{{ item.productName }}</h4>
                  <div class="item-meta">
                    <span class="item-quantity">Qty: {{ item.quantity }}</span>
                    <span class="item-price">₦{{ item.unitPrice.toLocaleString() }} each</span>
                  </div>
                </div>
                <div class="item-total">
                  <span class="total-price">₦{{ item.totalPrice.toLocaleString() }}</span>
                </div>
              </div>
            </div>

            <div class="order-footer">
              <div class="order-total">
                <span class="total-label">Total Amount:</span>
                <span class="total-amount">{{ formatPrice(order.totalAmount) }}</span>
              </div>
              <div class="order-actions">
                <button class="btn-view-details" (click)="viewOrderDetails(order)">
                  <i class="bi bi-eye"></i>
                  View Details
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty Orders -->
        <div class="empty-orders" *ngIf="orders.length === 0">
          <div class="empty-content">
            <div class="empty-icon">
              <i class="bi bi-box"></i>
            </div>
            <h3>No Orders Found</h3>
            <p>No orders found for the provided credentials. Please check your email and secret code.</p>
            <button class="btn-try-again" (click)="resetTracking()">
              <i class="bi bi-arrow-clockwise"></i>
              Try Again
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer> 